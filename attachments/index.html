<html>

<head>

	<script src="jquery.min.js"></script>
	<script src="jquery.url.js"></script>
	<script src="/_utils/script/jquery.couch.js?0.11.0"></script>

	<script>
	(function($) {

		var url = $.url()
		
		//	
		// Get the attached pages from the document in couchdb
		//
		var doc = $.couch.db(url.segment(1)).openDoc(url.segment(2), {
              success: function(doc) {
        		var pages = [] 
				// Only put files that start with "page" into the pages array
				$.each(doc._attachments, function (key, value) {
					if(key.indexOf("images/page") === 0) {
						pages.push(key)
					}
				})
				pages.sort()

				//
				// Display the page in the given url
				//
				var thisPage = 0
				if(url.param("page")) {
					thisPage = parseInt(url.param("page"))
				}
				$(".view").html('<iframe width="100%" height="100%" src="' + url.attr("directory") + '/' + pages[thisPage] + '">')



				// 
				// Set up the next and previous URLs
				//		

				// Determine next and previous pages
				if(thisPage == pages.length) {
					nextPage = 0
				}
				else {
					nextPage = thisPage + 1
				}

				if(thisPage == 0) {
					previousPage = pages.length
				}
				else {
					previousPage = thisPage - 2
				}
				// Set the URLs
				$("a.next").attr("href", url.attr("path") + "?page=" + nextPage)
				$("a.previous").attr("href", url.attr("path") + "?page=" + previousPage)

			  }
            })
	})(jQuery);
	</script>



	<style>

		/* fix the nav */
		.nav {
			position: fixed;
			bottom: 0px;
		}

	</style>



<body>

	<div class="view">
		Loading...
	</div>

	<div class="nav">
		<a class="previous" href="#previous"><-- Previous </a>
		<span class="nav-spacer"> ~~~ </span> 
		<a class="next" href="#next">Next --></a>	
	</div>

</body>

</html>